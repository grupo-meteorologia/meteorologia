#!/usr/bin/env bash
set -euo pipefail

JOBS=${1:-4}
DEPTH=${2:-0}

echo "ğŸ”„ Sync submodule URL"
git submodule sync --recursive

echo "ğŸ“¦ Updating submodules"
if (( DEPTH > 0 )); then
  git submodule update --init --recursive --jobs "$JOBS" --depth "$DEPTH"
else
  git submodule update --init --recursive --jobs "$JOBS"
fi

echo "ğŸš€ Pulling latest main"
git submodule update --remote --merge --recursive

echo
echo "ğŸ“ Checking submodule pointers"
if git diff --quiet; then
  echo "â†’ No pointer changes to commit."
else
  echo "â†’ Committing submodule pointer updates"
  git add .
  git commit -m "chore: update submodule pointers"
  echo "â†’ Pushing parent repo to origin/main"
  git push origin main
fi

echo "ğŸ‰ All submodules up to date!"
